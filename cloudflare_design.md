# Update Spec — Align App Setup With Your Actual Mock Data

This section patches the original Product Feedback Tracker spec so an AI can scaffold the app using the **exact mock data shape and generation style** you uploaded:
- `/src/data/mockFeedback.js`
- `/src/data/mockUsers.js`
- (also referenced) `/src/data/mockTags.js`

---

## 1) Actual Mock Data Source of Truth

### 1.1 `src/data/mockUsers.js` (Uploaded)
Exports:
- `mockUsers: Array<{ id, name, handle, company }>`

Example shape:
- `id: "u1"`
- `name: "Alex Kim"`
- `handle: "@alexk"`
- `company: "Northwind"`

---

### 1.2 `src/data/mockFeedback.js` (Uploaded)
Exports:
- `mockFeedback: FeedbackItem[]` with **60 items** generated via `Array.from({ length: 60 }).map(...)`

**Important details from your file:**
- Imports:
  - `mockTags` from `"./mockTags"`
  - `mockUsers` from `"./mockUsers"`
- `sourceType` is one of:
  - `"SUPPORT" | "DISCORD" | "GITHUB" | "EMAIL" | "X" | "FORUM"`
- `sourceLabel` is derived from a mapping:
  - SUPPORT → `"Support Tickets"`
  - DISCORD → `"Discord"`
  - GITHUB → `"GitHub Issues"`
  - EMAIL → `"Email"`
  - X → `"X/Twitter"`
  - FORUM → `"Community Forums"`
- `createdAt` is ISO, generated as:
  - `new Date(Date.now() - index * 6 * 60 * 60 * 1000).toISOString()`
  - meaning items are spaced **6 hours apart**
- `tags` are drawn from `mockTags` with `tagCount = (index % 3) + 1`
- `sourceMetadata` is generated by `createMetadata(sourceType, index)` with these shapes:

#### SUPPORT
- `{ ticketId, queue, slaHoursRemaining }`
  - `queue: "Enterprise" | "SMB"`
  - `slaHoursRemaining: number`

#### DISCORD
- `{ server, channel, messageId }`
  - `server: "Cloudflare Devs" | "Customer Hub"`
  - `channel: "#alerts" | "#feedback"`
  - `messageId` currently uses `Date.now()` (unstable per run)

#### GITHUB
- `{ repo, issueNumber, labels }`
  - `repo: "cloudflare/pm" | "cloudflare/edge"`
  - `labels: ["bug","triage"] | ["feature"]`

#### EMAIL
- `{ mailbox, threadId, fromDomain }`
  - `mailbox: "support@" | "feedback@"`
  - `threadId` currently uses `Date.now()` (unstable per run)

#### X
- `{ tweetId, followerCount }`
  - `tweetId` currently uses `Date.now()` (unstable per run)

#### FORUM
- `{ forumName, category, upvotes }`
  - `forumName: "Community Hub"`
  - `category: "Performance" | "UX"`
  - `upvotes: number`

---

## 2) Patch: “Normalized Data Model” Should Match Your Mock Exactly

### 2.1 Canonical Type
Use this as the canonical `FeedbackItem` shape everywhere (table, detail panel, queries).
It matches your generator output:

- `id: string` (e.g. `fb-1`)
- `sourceType: "SUPPORT" | "DISCORD" | "GITHUB" | "EMAIL" | "X" | "FORUM"`
- `sourceLabel: string` (from mapping)
- `title: string`
- `snippet: string`
- `body: string`
- `authorName: string`
- `authorHandle?: string`
- `company?: string`
- `createdAt: string` (ISO)
- `status: "NEW" | "TRIAGED" | "IN_PROGRESS" | "CLOSED"`
- `type: "BUG" | "FEATURE" | "QUESTION" | "PRAISE"`
- `priority: "P0" | "P1" | "P2" | "P3"`
- `sentiment: "NEGATIVE" | "NEUTRAL" | "POSITIVE"`
- `tags: string[]` (whatever `mockTags` contains; assume string tags)
- `productArea?: string` (your generator uses: `"Networking" | "Security" | "Analytics" | "Edge"`)
- `sourceMetadata: object` (source-specific shapes listed above)

---

## 3) Patch: Mock Tags File Requirement

Your `mockFeedback.js` imports:
- `import { mockTags } from "./mockTags";`

So the scaffold MUST include:
- `src/data/mockTags.js` exporting `mockTags`

**Assumption boundary:**
- If your `mockTags` is not yet defined, define it as a simple `string[]` (ex: `["performance", "billing", "ux", ...]`)
- Ensure tags are **human-readable** and match the “Top Themes” concept.

---

## 4) Patch: Make IDs Stable (Recommended)
Right now, Discord/Email/X metadata uses `Date.now()`:
- `messageId: \`msg-${index}-${Date.now()}\``
- `threadId: \`thr-${index}-${Date.now()}\``
- `tweetId: \`tw-${index}-${Date.now()}\``

This makes mocks change every reload, which can break:
- `?selected=<id>` persistence
- “Related items” caching
- predictable UI tests

**Recommended rule for mock stability:**
- Replace `Date.now()` usages with stable deterministic strings:
  - `messageId: \`msg-${index}\``
  - `threadId: \`thr-${index}\``
  - `tweetId: \`tw-${index}\``

Keep `createdAt` as-is (it’s fine if it shifts per session), or make it deterministic too if you want fully stable seeds.

---

## 5) Patch: TanStack Query “Mock API” Should Wrap Your Existing Arrays

### 5.1 Data Imports
All query functions should read from:
- `mockFeedback` and `mockUsers` (and `mockTags` where needed)

### 5.2 Query Functions (Same names, but now grounded to your mocks)
Implement these query entrypoints exactly (even though data is local), so you can swap to real API later:

- `useFeedbackItemsQuery(viewParams)`
  - filters/sorts in-memory using `mockFeedback`
  - returns `items`, `total`, and optional `facets` (counts)

- `useFeedbackItemByIdQuery(id)`
  - `mockFeedback.find(x => x.id === id)`

- `useSourceCountsQuery()`
  - counts by `sourceType`

- `useTagCountsQuery()`
  - counts by tag string

### 5.3 Filtering Logic Must Support Your Sidebar + Table
Use these fields from the mock items:
- `sourceType`
- `status`
- `priority`
- `type`
- `tags[]`
- free-text search over: `title`, `snippet`, `body`, `authorName`, `company`

### 5.4 Sorting Must Support These Columns
- `createdAt`
- `priority`
- `status`
- `sourceType`

---

## 6) Patch: Source-Specific Filters Must Read `sourceMetadata`
On `/sources/:source`, source-specific filter UI should operate on `sourceMetadata`:

- SUPPORT: `queue`, `slaHoursRemaining`
- DISCORD: `server`, `channel`
- GITHUB: `repo`, `labels`
- EMAIL: `mailbox`, `fromDomain`
- X: `followerCount`
- FORUM: `category`, `upvotes`

---

## 7) Patch: “AI Chat Section” Data Access Pattern (Mock Mode)
Even in mock mode, the AI chat overlay should be able to:
- read current filters + selected item
- summarize a selected item (`title/snippet/body/sourceMetadata`)
- answer “what’s happening?” by aggregating top tags/sources/statuses from the currently filtered dataset

**No real LLM calls required in mock mode**, but the architecture should expose a clear seam:
- `chatService.ask({ filters, selectedId })`
- later swapped to a Worker endpoint

---

## 8) Prompt Addendum — What the AI Should Generate in Codebase
When scaffolding the project, the AI should:

1) Keep `src/data/mockFeedback.js` logic intact (or apply stability patch in Section 4).
2) Ensure `src/data/mockTags.js` exists and matches the import.
3) Create a `queries/feedbackQueries.js` layer that:
   - imports mock arrays
   - applies filter/sort/pagination
   - returns consistent shapes for TanStack Query
4) Ensure TanStack Table columns map exactly to your fields:
   - Source: `sourceType + sourceLabel`
   - Title: `title + snippet`
   - Type: `type`
   - Priority: `priority`
   - Status: `status`
   - Sentiment: `sentiment`
   - Created: `createdAt`
   - Tags: `tags`

---

## 9) Minimal “Data Contract” Guarantees
Any code written against the mocks must assume:

- `tags` is always an array (may be empty)
- `authorHandle` and `company` may be undefined (even if mocks include them)
- `sourceMetadata` varies by `sourceType` and should be accessed safely
- `createdAt` is ISO string and should be formatted in UI (relative time)

---

## 10) Files Referenced (Your Upload)
- `mockFeedback.js` present at: `/mnt/data/mockFeedback.js` (uploaded)
- `mockUsers.js` present at: `/mnt/data/mockUsers.js` (uploaded)

When copying into the repo, place them here:
- `src/data/mockFeedback.js`
- `src/data/mockUsers.js`
- plus required:
- `src/data/mockTags.js`
